<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>RPG Assessment for Ellice Huang</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="main_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_files/libs/quarto-html/quarto.js"></script>
<script src="main_files/libs/quarto-html/popper.min.js"></script>
<script src="main_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main_files/libs/quarto-html/anchor.min.js"></script>
<link href="main_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_files/libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="main_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main_files/libs/bootstrap/bootstrap-4f863c1579693c9d56bbaaf04c81ce69.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="main.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">RPG Assessment for Ellice Huang</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="c517adb5-dccf-40f7-8572-6769583a012c" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lightgbm <span class="im">import</span> LGBMClassifier</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    confusion_matrix, classification_report, roc_auc_score, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    precision_score, recall_score, f1_score</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="3ea3fd41-b973-4663-b0b8-ca15e1f340e6" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>card <span class="op">=</span> pd.read_csv(<span class="st">'data/kaggle/CardBase.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>customer <span class="op">=</span> pd.read_csv(<span class="st">'data/kaggle/CustomerBase.csv'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>fraud <span class="op">=</span> pd.read_csv(<span class="st">'data/RAND_FraudBase.csv'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>transaction <span class="op">=</span> pd.read_csv(<span class="st">'data/kaggle/TransactionBase.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="task-1" class="level2">
<h2 class="anchored" data-anchor-id="task-1">TASK 1</h2>
<p><em>Writing a function that filters and aggregates data by card family and customer segment, based on a date and customer age range. Function is called for age 28-44 and date May 10th - Jul 16th (inclusive) below.</em></p>
<div id="fa8510a4-764c-48f1-a9cc-fa731eda28fa" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_summarize_transactions(min_age, max_age, start_date, end_date):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes an age range and date range and returns a data frame</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    with the ount, mean, and standard deviation of the transaction amounts </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    by card family and customer segment, limited to the inputted ranges.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Arguments: </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">        min_age (int): Lower bound for age range</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">        max_age (int): Upper bound for age range</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">        start_date (date): Lower bound date age range</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">        end_date (date): Upper bound date age range</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># merge transaction data with card data (on Card_Number and Credit_Card_ID) and customer data (on Cust_ID)</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    merged <span class="op">=</span> transaction.merge(card, left_on<span class="op">=</span><span class="st">'Credit_Card_ID'</span>, right_on<span class="op">=</span><span class="st">'Card_Number'</span>).merge(customer, on<span class="op">=</span><span class="st">'Cust_ID'</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert date to datetime type for comparison</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    merged[<span class="st">'Transaction_Date1'</span>] <span class="op">=</span> pd.to_datetime(merged.Transaction_Date, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%d</span><span class="st">-%b-%y'</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># filter data for the given date and age range</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    filtered <span class="op">=</span> (merged.loc[(merged.Age<span class="op">&gt;=</span>min_age) <span class="op">&amp;</span> (merged.Age<span class="op">&lt;=</span>max_age)]</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                      .loc[(merged.Transaction_Date1<span class="op">&gt;=</span>start_date) <span class="op">&amp;</span> (merged.Transaction_Date1<span class="op">&lt;=</span>end_date)])</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># group by/aggregate for count, mean, and standard deviation of transaction values</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    grouped <span class="op">=</span> filtered.groupby([<span class="st">'Card_Family'</span>, </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                                <span class="st">'Customer_Segment'</span>]).agg({<span class="st">'Transaction_Value'</span>: [<span class="st">'count'</span>, <span class="st">'mean'</span>, <span class="st">'std'</span>]}).reset_index()</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grouped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="c4b0dfda-a080-4aa7-aa9c-23963f252f77" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># displaying results of calling the function for age 28-44 and date May 10th - Jul 16th (inclusive)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> pd.to_datetime(<span class="st">'10-May-2016'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%d</span><span class="st">-%b-%Y'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> pd.to_datetime(<span class="st">'16-Jul-2016'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%d</span><span class="st">-%b-%Y'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> filter_summarize_transactions(min_age<span class="op">=</span><span class="dv">28</span>, max_age<span class="op">=</span><span class="dv">44</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                       start_date<span class="op">=</span>start_date, end_date<span class="op">=</span>end_date)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>display(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Card_Family</th>
<th data-quarto-table-cell-role="th">Customer_Segment</th>
<th colspan="3" data-quarto-table-cell-role="th" data-halign="left">Transaction_Value</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Gold</td>
<td>Diamond</td>
<td>159</td>
<td>25947.490566</td>
<td>14295.469532</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Gold</td>
<td>Gold</td>
<td>110</td>
<td>24850.972727</td>
<td>13211.350331</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Gold</td>
<td>Platinum</td>
<td>60</td>
<td>22826.933333</td>
<td>14499.972092</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Platinum</td>
<td>Diamond</td>
<td>91</td>
<td>23105.197802</td>
<td>13891.667734</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Platinum</td>
<td>Gold</td>
<td>65</td>
<td>24459.815385</td>
<td>13725.743636</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Platinum</td>
<td>Platinum</td>
<td>65</td>
<td>24620.600000</td>
<td>14958.461580</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Premium</td>
<td>Diamond</td>
<td>195</td>
<td>23435.748718</td>
<td>15538.776861</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Premium</td>
<td>Gold</td>
<td>136</td>
<td>23741.492647</td>
<td>14526.895788</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Premium</td>
<td>Platinum</td>
<td>93</td>
<td>25273.182796</td>
<td>14595.783222</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="task-2" class="level2">
<h2 class="anchored" data-anchor-id="task-2">TASK 2</h2>
<p><em>Building a logistic regression model using the statsmodels package to predict fraud using transaction value, value as a share of limit, age, card family, customer segment, and transaction segment; no cross validation.</em></p>
<div id="24a50e9c-1b7e-47ca-97d6-841194660adb" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge datasets</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> (transaction.merge(card, how<span class="op">=</span><span class="st">'left'</span>, left_on<span class="op">=</span><span class="st">'Credit_Card_ID'</span>, right_on<span class="op">=</span><span class="st">'Card_Number'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                   .merge(customer, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span><span class="st">'Cust_ID'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                   .merge(fraud, how<span class="op">=</span><span class="st">'left'</span>,  on<span class="op">=</span><span class="st">'Transaction_ID'</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>data.Fraud_Flag <span class="op">=</span> data.Fraud_Flag.fillna(<span class="dv">0</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create value as share of limit variable</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Limit_Share'</span>] <span class="op">=</span> data[<span class="st">'Transaction_Value'</span>] <span class="op">/</span> data[<span class="st">'Credit_Limit'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The results of a logistic model using transaction value, credit limit share, age, card family, customer segment, and transaction segment are displayed below.</p>
<p>Here are a few takeaways from this model:</p>
<ul>
<li>There are likely other factors that should be accounted for in predicting fraud. The <em>R-squared value</em> of 0.1687 suggests that only about 16.87% of the variability in the fraud variable can be explained by the model.</li>
<li>Higher <em>credit limit share</em> values are associated with increased odds of fraud, by about 6% (exp(0.0595)) per unit of increase in limit share. This coefficient is statistically significant (p&lt;0.001).</li>
<li>In terms of <em>age</em>, a statistically significant positive coefficient (p&lt;0.1) suggests that for each additional year of age, the odds of being associated with a fradulent transaction increases by about 0.8%.</li>
<li>In terms of <em>card family</em>, compared to the gold family, platinum card transactions are associated with lower odds of being fraudulent by 96% (statistically significant with p&lt;.001) while premium card transactions are associated with substantially higher odds of being fraudulent by 227% (p&lt;.001).</li>
<li>In terms of <em>customer segment</em>, compared to the diamond group, gold customer transactions are associated with lower odds of being fraud by about 17% (p&lt;.001). The platinum segment coefficient is not statistically significant, suggesting no strong difference in odds.</li>
<li>Finally, none of the <em>transaction segment</em> coefficients are statistically significiant, indicating that these segments are not helpful indicators in predicting the likelihood of fraud.</li>
</ul>
<div id="489f583e-087b-4852-ab05-4d45472a8854" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fitting logstic regression with statsmodels package</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define X and y</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data[[<span class="st">'Transaction_Value'</span>, <span class="st">'Limit_Share'</span>, <span class="st">'Age'</span>, <span class="st">'Card_Family'</span>, <span class="st">'Customer_Segment'</span>, <span class="st">'Transaction_Segment'</span>]]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(data<span class="op">=</span>X, drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">'Fraud_Flag'</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.Logit(y, X.astype(<span class="bu">float</span>)).fit(disp<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Logit Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>Fraud_Flag</td>
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>10000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>Logit</td>
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>9978</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>MLE</td>
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>21</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Mon, 30 Dec 2024</td>
<td data-quarto-table-cell-role="th">Pseudo R-squ.:</td>
<td>0.1687</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>15:01:44</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-4849.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">converged:</td>
<td>True</td>
<td data-quarto-table-cell-role="th">LL-Null:</td>
<td>-5833.6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th">LLR p-value:</td>
<td>0.000</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">z</td>
<td data-quarto-table-cell-role="th">P&gt;|z|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>-1.6552</td>
<td>0.156</td>
<td>-10.589</td>
<td>0.000</td>
<td>-1.962</td>
<td>-1.349</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Transaction_Value</td>
<td>2.497e-06</td>
<td>1.76e-06</td>
<td>1.423</td>
<td>0.155</td>
<td>-9.43e-07</td>
<td>5.94e-06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Limit_Share</td>
<td>0.0595</td>
<td>0.016</td>
<td>3.826</td>
<td>0.000</td>
<td>0.029</td>
<td>0.090</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Age</td>
<td>0.0080</td>
<td>0.003</td>
<td>2.831</td>
<td>0.005</td>
<td>0.002</td>
<td>0.014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Card_Family_Platinum</td>
<td>-3.2879</td>
<td>0.219</td>
<td>-14.995</td>
<td>0.000</td>
<td>-3.718</td>
<td>-2.858</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Card_Family_Premium</td>
<td>1.1844</td>
<td>0.057</td>
<td>20.709</td>
<td>0.000</td>
<td>1.072</td>
<td>1.297</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Customer_Segment_Gold</td>
<td>-0.1900</td>
<td>0.057</td>
<td>-3.357</td>
<td>0.001</td>
<td>-0.301</td>
<td>-0.079</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Customer_Segment_Platinum</td>
<td>-0.0230</td>
<td>0.064</td>
<td>-0.360</td>
<td>0.719</td>
<td>-0.148</td>
<td>0.102</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG12</td>
<td>0.0733</td>
<td>0.133</td>
<td>0.550</td>
<td>0.582</td>
<td>-0.188</td>
<td>0.334</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG13</td>
<td>-0.0018</td>
<td>0.134</td>
<td>-0.014</td>
<td>0.989</td>
<td>-0.265</td>
<td>0.261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG14</td>
<td>-0.0515</td>
<td>0.138</td>
<td>-0.372</td>
<td>0.710</td>
<td>-0.322</td>
<td>0.219</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG15</td>
<td>0.0737</td>
<td>0.133</td>
<td>0.552</td>
<td>0.581</td>
<td>-0.188</td>
<td>0.335</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG16</td>
<td>-0.2070</td>
<td>0.138</td>
<td>-1.501</td>
<td>0.133</td>
<td>-0.477</td>
<td>0.063</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG17</td>
<td>0.0573</td>
<td>0.135</td>
<td>0.426</td>
<td>0.670</td>
<td>-0.207</td>
<td>0.321</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG18</td>
<td>-0.1205</td>
<td>0.135</td>
<td>-0.892</td>
<td>0.372</td>
<td>-0.385</td>
<td>0.144</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG19</td>
<td>-0.1516</td>
<td>0.138</td>
<td>-1.096</td>
<td>0.273</td>
<td>-0.423</td>
<td>0.120</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG20</td>
<td>0.2471</td>
<td>0.132</td>
<td>1.870</td>
<td>0.061</td>
<td>-0.012</td>
<td>0.506</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG21</td>
<td>0.0630</td>
<td>0.135</td>
<td>0.467</td>
<td>0.641</td>
<td>-0.202</td>
<td>0.328</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG22</td>
<td>0.0428</td>
<td>0.135</td>
<td>0.316</td>
<td>0.752</td>
<td>-0.222</td>
<td>0.308</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG23</td>
<td>0.0966</td>
<td>0.133</td>
<td>0.729</td>
<td>0.466</td>
<td>-0.163</td>
<td>0.356</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG24</td>
<td>0.1300</td>
<td>0.134</td>
<td>0.969</td>
<td>0.333</td>
<td>-0.133</td>
<td>0.393</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Transaction_Segment_SEG25</td>
<td>-0.0274</td>
<td>0.136</td>
<td>-0.201</td>
<td>0.841</td>
<td>-0.294</td>
<td>0.239</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="task-3" class="level2">
<h2 class="anchored" data-anchor-id="task-3">TASK 3</h2>
<p><em>Implementing a lightGBM and logistic regression classification algorithm using scikit-learn to predict fraud using Transaction Value, Credit Limit, Age, and Card Family as features/predictors with 80/20 cross validation. Transactions calssified as fraud if they have a greater than 0.25 (25%) predicted probability.</em></p>
<div id="50591de0-5bd8-45ee-b171-a28c0b4d6dfe" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train/test split</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define data</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>model_data <span class="op">=</span> data[[<span class="st">'Fraud_Flag'</span>, <span class="st">'Transaction_Value'</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'Credit_Limit'</span>, <span class="st">'Age'</span>, <span class="st">'Card_Family'</span>]]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>model_data <span class="op">=</span> pd.get_dummies(model_data, columns<span class="op">=</span>[<span class="st">'Card_Family'</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># split data</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> model_data.drop(<span class="st">'Fraud_Flag'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model_data[<span class="st">'Fraud_Flag'</span>]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">54</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="model-1-lgbm" class="level3">
<h3 class="anchored" data-anchor-id="model-1-lgbm">Model 1: LGBM</h3>
<div id="23cadb2f-6af6-4720-8702-f8418b72a242" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lgbm_model <span class="op">=</span> LGBMClassifier(random_state<span class="op">=</span><span class="dv">54</span>, verbosity<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>lgbm_model.fit(X_train, y_train)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get predictions</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>lgbm_probs <span class="op">=</span> lgbm_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>lgbm_preds <span class="op">=</span> (lgbm_probs <span class="op">&gt;</span> <span class="fl">0.25</span>).astype(<span class="bu">int</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get metrics</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>lgbm_cm <span class="op">=</span> confusion_matrix(y_test, lgbm_preds)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>lgbm_cr <span class="op">=</span> classification_report(y_test, lgbm_preds, output_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>lgbm_auc <span class="op">=</span> roc_auc_score(y_test, lgbm_probs)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>lgbm_precision <span class="op">=</span> precision_score(y_test, lgbm_preds)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>lgbm_recall <span class="op">=</span> recall_score(y_test, lgbm_preds)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>lgbm_f1 <span class="op">=</span> f1_score(y_test, lgbm_preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For this task, I chose to implement a LightGBM classification model. The confusion matrix and classification report for the LGBM model are displayed below. The AUC score for this model is 0.812.</p>
<div id="022bd8c6-c728-45fe-9f72-6920799a7f0d" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LGBM confusion matrix</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>lgbm_cm_df <span class="op">=</span> pd.DataFrame(lgbm_cm)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>lgbm_cm_df.columns <span class="op">=</span> [<span class="st">'pred_0'</span>,<span class="st">'pred_1'</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>lgbm_cm_df.index <span class="op">=</span> [<span class="st">'actual_0'</span>,<span class="st">'actual_1'</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>display(lgbm_cm_df)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># LGBM classification report</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>display(pd.DataFrame(lgbm_cr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pred_0</th>
<th data-quarto-table-cell-role="th">pred_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">actual_0</td>
<td>1007</td>
<td>463</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">actual_1</td>
<td>134</td>
<td>396</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0.0</th>
<th data-quarto-table-cell-role="th">1.0</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">macro avg</th>
<th data-quarto-table-cell-role="th">weighted avg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">precision</td>
<td>0.882559</td>
<td>0.461001</td>
<td>0.7015</td>
<td>0.671780</td>
<td>0.770846</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">recall</td>
<td>0.685034</td>
<td>0.747170</td>
<td>0.7015</td>
<td>0.716102</td>
<td>0.701500</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">f1-score</td>
<td>0.771352</td>
<td>0.570194</td>
<td>0.7015</td>
<td>0.670773</td>
<td>0.718045</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">support</td>
<td>1470.000000</td>
<td>530.000000</td>
<td>0.7015</td>
<td>2000.000000</td>
<td>2000.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="model-2-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="model-2-logistic-regression">Model 2: Logistic Regression</h3>
<div id="0b2e0eae-b0d4-4ca0-b1d5-9f6669089b94" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>log_reg_model <span class="op">=</span> LogisticRegression(max_iter<span class="op">=</span><span class="dv">1000</span>, random_state<span class="op">=</span><span class="dv">54</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>log_reg_model.fit(X_train, y_train)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get predictions</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>log_probs <span class="op">=</span> log_reg_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>log_preds <span class="op">=</span> (log_probs <span class="op">&gt;</span> <span class="fl">0.25</span>).astype(<span class="bu">int</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get metrics</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>log_cm <span class="op">=</span> confusion_matrix(y_test, log_preds)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>log_cr <span class="op">=</span> classification_report(y_test, log_preds,output_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>log_auc <span class="op">=</span> roc_auc_score(y_test, log_probs)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>log_precision <span class="op">=</span> precision_score(y_test, log_preds)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>log_recall <span class="op">=</span> recall_score(y_test, log_preds)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>log_f1 <span class="op">=</span> f1_score(y_test, log_preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The confusion matrix and classification report for the logit model are displayed below. The AUC score for this model is 0.788.</p>
<div id="279e777b-896d-4d63-acdc-5925470a2881" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># logit confusion matrix</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>log_cm_df <span class="op">=</span> pd.DataFrame(log_cm)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>log_cm_df.columns <span class="op">=</span> [<span class="st">'pred_0'</span>,<span class="st">'pred_1'</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>log_cm_df.index <span class="op">=</span> [<span class="st">'actual_0'</span>,<span class="st">'actual_1'</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>display(log_cm_df)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># logit classification report</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>display(pd.DataFrame(log_cr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pred_0</th>
<th data-quarto-table-cell-role="th">pred_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">actual_0</td>
<td>1098</td>
<td>372</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">actual_1</td>
<td>177</td>
<td>353</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0.0</th>
<th data-quarto-table-cell-role="th">1.0</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">macro avg</th>
<th data-quarto-table-cell-role="th">weighted avg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">precision</td>
<td>0.861176</td>
<td>0.486897</td>
<td>0.7255</td>
<td>0.674037</td>
<td>0.761992</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">recall</td>
<td>0.746939</td>
<td>0.666038</td>
<td>0.7255</td>
<td>0.706488</td>
<td>0.725500</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">f1-score</td>
<td>0.800000</td>
<td>0.562550</td>
<td>0.7255</td>
<td>0.681275</td>
<td>0.737076</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">support</td>
<td>1470.000000</td>
<td>530.000000</td>
<td>0.7255</td>
<td>2000.000000</td>
<td>2000.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="metric-evaluation-table" class="level3">
<h3 class="anchored" data-anchor-id="metric-evaluation-table">Metric evaluation table</h3>
<p>The table below summarizes the evaluation metrics for the lgbm and logistic models.</p>
<div id="691d2cff-2f7a-4984-be85-d9df600c7955" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics table</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> pd.DataFrame(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'metric'</span>: [<span class="st">'precision'</span>, <span class="st">'recall'</span>, <span class="st">'f1'</span>, <span class="st">'auc'</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'true negative'</span>, <span class="st">'false positive'</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'false negative'</span>, <span class="st">'true positive'</span>],</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">'lgbm'</span>: [lgbm_precision, lgbm_recall, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                  lgbm_f1, lgbm_auc,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                  lgbm_cm[<span class="dv">0</span>][<span class="dv">0</span>], lgbm_cm[<span class="dv">0</span>][<span class="dv">1</span>], </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                  lgbm_cm[<span class="dv">1</span>][<span class="dv">0</span>], lgbm_cm[<span class="dv">1</span>][<span class="dv">1</span>]],</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">'logistic'</span>: [log_precision, log_recall,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                      log_f1, log_auc,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                      log_cm[<span class="dv">0</span>][<span class="dv">0</span>], log_cm[<span class="dv">0</span>][<span class="dv">1</span>], </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                      log_cm[<span class="dv">1</span>][<span class="dv">0</span>], log_cm[<span class="dv">1</span>][<span class="dv">1</span>]]</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">lgbm</th>
<th data-quarto-table-cell-role="th">logistic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>precision</td>
<td>0.461001</td>
<td>0.486897</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>recall</td>
<td>0.747170</td>
<td>0.666038</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>f1</td>
<td>0.570194</td>
<td>0.562550</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>auc</td>
<td>0.811617</td>
<td>0.787994</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>true negative</td>
<td>1007.000000</td>
<td>1098.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>false positive</td>
<td>463.000000</td>
<td>372.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>false negative</td>
<td>134.000000</td>
<td>177.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>true positive</td>
<td>396.000000</td>
<td>353.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="metric-evaluation-plots" class="level3">
<h3 class="anchored" data-anchor-id="metric-evaluation-plots">Metric evaluation plots</h3>
<p>Below the ROC and precision-recall curves for the lgbm and logistic models are displayed.</p>
<div id="e73c722c-89df-441b-a923-371b8251a3fb" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot ROC and precision-recall curves</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> RocCurveDisplay, PrecisionRecallDisplay</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC curves</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(log_reg_model, X_test, y_test, ax<span class="op">=</span>ax1, name<span class="op">=</span><span class="st">'Logistic'</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(lgbm_model, X_test, y_test, ax<span class="op">=</span>ax1, name<span class="op">=</span><span class="st">'LightGBM'</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'ROC Curves'</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>ax1.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)  <span class="co"># diagonal line for reference of random model</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Precision-recall curves</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>PrecisionRecallDisplay.from_estimator(log_reg_model, X_test, y_test, ax<span class="op">=</span>ax2, name<span class="op">=</span><span class="st">'Logistic'</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>PrecisionRecallDisplay.from_estimator(lgbm_model, X_test, y_test, ax<span class="op">=</span>ax2, name<span class="op">=</span><span class="st">'LightGBM'</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Precision-Recall Curves'</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/cell-14-output-1.png" width="757" height="384" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="task-4" class="level2">
<h2 class="anchored" data-anchor-id="task-4">TASK 4</h2>
<section id="model-comparison" class="level3">
<h3 class="anchored" data-anchor-id="model-comparison">Model comparison</h3>
<p>Based on my analysis, I conclude that a LightGBM model would be preferable over a logistic regression model in a production setting.</p>
<p>It is important to note that I assume a credit card company’s primary goal is to minimize false negatives and prioritize recall over precision. Missing actual fraudulent cases would be much more costly than falsely flagging legitimate transactions. While false alarms can inconvenience customers, this is of lower priority than overlooking fraud, which would result in financial losses and reputational damage.</p>
<p>My conclusion is supported by the metrics table and plots above:</p>
<ul>
<li>The LGBM model has a substantially higher <em>recall</em> score (0.75) than the logistic model (0.67), meaning that the LGBM model is able to capture a significant portion of fraudulent transactions.</li>
<li>While the logistic model has higher <em>precision</em> (0.49) than the lgbm model (0.46), this difference is negligible compared to the significant difference in recall.</li>
<li>The <em>precision-recall graph</em> visualizes the difference in precision and recall between the two models. The LGBM curve is slightly higher and pulled to the right, signifying that it outperforms the logistic model.</li>
<li>The <em>F1 scores</em> are similar, with the LGBM model scoring slightly higher (.57 vs .56), suggesting both models are able to balance precision and recall.</li>
<li>The LGBM model also has a slightly higher <em>AUC score</em> (.81 vs.&nbsp;.79), indicating the LGBM model is more accurate at distinguishing between the two classes. The <em>ROC curves</em> visualize this, showing that for different classification thresholds, the LGBM model has better sensitivity and specificity on average.</li>
<li>Looking at the numbers more closely, the LGBM model is able to identify more true positives (396 vs 353 out of 530 total fraud cases). While the logistic model is able to limit more false positives (372 vs 463), I believe the LGBM’s better ability to identify fraud makes it the better model for this setting.</li>
</ul>
<p>Finally, LGBM is the better model in terms of large-scale performance and scalability. A fraud classifier would have to handle a significant amount of data, with millions of users and transactions. LGBM models <a href="https://www.nature.com/articles/s41598-022-20149-z?utm_source=chatgpt.com">outperform</a> logistic models and improve with larger sample sizes and datasets. They have superior speed and efficiency, and exhibit efficient resource utilization even as datasets grow.</p>
<p>To limit the false positive rate and improve customer satisfaction, I would recommend adjusting the decision threshold for classifying fraud cases, implementing additional verification steps for flagged transactions, and developing user-friendly methods for customers to verify whether flagged transactions are actually fraudulent.</p>
</section>
<section id="experiment-recommendation" class="level3">
<h3 class="anchored" data-anchor-id="experiment-recommendation">Experiment recommendation</h3>
<p>The program described could be implemented as a randomized controlled trial. To determine whether the anti-fraud program is effective, I suggest the following strategy:</p>
<ol type="1">
<li>Collect data over a minimum of 12-18 months to allow for enough time to detect fraudulent patterns and account for seasonal/holiday variations.</li>
<li>Collect all transaction information, including ID, date, merchant description, credit card information, amount, and whether the transaction was fraudulent.</li>
<li>Collect customer information, such as age, education level, credit score, income level, and residence zip code.</li>
<li>Collect information on outcome variables that indicate whether the program was effective. This includes the number of fraud cases, the company’s financial losses due to fraud, customer complaints due to falsely flagged transactions, and the operational costs associated with the anti-fraud program, such as implementation or resource utilization. The company can also consider implementing surveys to gauge program impact on customer satisfaction.</li>
<li>Implement a series of regression models to analyze the differences in outcomes between treatment and control groups. The outcome variables would include financial losses, number of fraudulent cases, and customer satisfaction. The independent variable with the coefficient of interest is whether the transaction was treated with the anti-fraud program, and the remainder of the variables will serve as control variables.</li>
<li>Use the findings from the control variables to continually improve on the anti-fraud program. For example, the model may indicate that more fraudulent transactions occur during the holiday season, in particular zip codes, or higher age ranges.</li>
</ol>
<p>In order for the program to be deemed as effective, there would need to be a statistically significant treatment effect indicating that cases in the anti-fraud program were associated with less financial losses, less fraudulent cases, and better customer satisfaction. Because this is a randomized controlled trial, the treatment effect could be interpreted as a direct causal effect of the program. Importantly, these results should be substantial enough to outweigh the recorded operational costs of the program.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>